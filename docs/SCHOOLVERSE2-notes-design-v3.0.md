# **Schoolverse2**

è©³ç´°è¨­è¨ˆæ›¸ v3.0ï¼ˆãƒãƒ¼ãƒˆæ©Ÿèƒ½è¿½åŠ ç‰ˆï¼‰

ä½œæˆæ—¥: 2025å¹´11æœˆ28æ—¥

## ç›®æ¬¡

1. å®Ÿè£…çŠ¶æ³ã‚µãƒãƒªãƒ¼  
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€   
3. ç”»é¢è¨­è¨ˆ  
4. ãƒãƒ¼ãƒˆæ©Ÿèƒ½è¨­è¨ˆ  
5. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ  
6. APIè¨­è¨ˆ  
7. AIã‚³ãƒ¼ãƒè¨­è¨ˆ  
8. é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆè¨­è¨ˆ  
9. ãƒ†ã‚¹ãƒˆè¨­è¨ˆ  
10. ç’°å¢ƒå¤‰æ•°ãƒ»é–‹ç™ºã‚³ãƒãƒ³ãƒ‰  
11. å¤‰æ›´å±¥æ­´

---

# 1. å®Ÿè£…çŠ¶æ³ã‚µãƒãƒªãƒ¼

## 1.1 å…¨ä½“é€²æ—

Phase 1 MVPæ©Ÿèƒ½ã®å®Ÿè£…ãŒå¤§å¹…ã«é€²æ—ã—ã€ãƒãƒ¼ãƒˆæ©Ÿèƒ½ï¼ˆã‚­ãƒ£ãƒ³ãƒã‚¹ãƒ»ã‚«ãƒ¡ãƒ©ãƒ»OCRï¼‰ãŒæ–°è¦è¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚

| æ©Ÿèƒ½ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | å‚™è€ƒ |
| --- | :---: | --- |
| FR-A: èªè¨¼ | **å®Œäº†** | NextAuth Credentials Provider |
| FR-L1: AIã‚³ãƒ¼ãƒå¯¾è©± | **å®Œäº†** | Claude APIé€£æº (claude-sonnet-4-20250514) |
| FR-L2: ã‚¿ã‚¹ã‚¯ç®¡ç† | **å®Œäº†** | éšå±¤æ§‹é€ ãƒ»æ™‚é–“è¿½è·¡ãƒ»D&Då¯¾å¿œ |
| FR-L5: é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ | **å®Œäº†** | AIç”Ÿæˆãƒ»Markdownã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ |
| ã‚¯ãƒ¬ãƒ‰æ©Ÿèƒ½ | **å®Œäº†** | 11ç®‡æ¡ã€å®Ÿè·µãƒ­ã‚°ã€ä½“èª¿é€£æº |
| FR-K1: ãƒãƒ¼ãƒˆãƒ»ãƒ¡ãƒ¢ | **æ–°è¦** | ã‚­ãƒ£ãƒ³ãƒã‚¹ãƒ»ã‚«ãƒ¡ãƒ©ãƒ»OCRçµ±åˆ |
| FR-L3: ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ  | **éƒ¨åˆ†å®Œäº†** | ãƒ—ãƒ©ãƒ³ç”Ÿæˆã‚ã‚Šã€è©³ç´°ç®¡ç†æœªå®Ÿè£… |

## 1.2 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ |
| --- | --- |
| ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | Next.js 16.0.3 (App Router) |
| è¨€èª | TypeScript 5.9.3 |
| ORM | Prisma 6.19.0 |
| èªè¨¼ | NextAuth v4.24.13 |
| AI | @anthropic-ai/sdk 0.71.0 (claude-sonnet-4-20250514) |
| ã‚­ãƒ£ãƒ³ãƒã‚¹ | @excalidraw/excalidraw |
| OCR | tesseract.js (æ—¥æœ¬èª+è‹±èªå¯¾å¿œ) |
| ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° | Tailwind CSS v4 |
| ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | Zod v4.1.13 |
| D&D | @dnd-kit/core 6.1.0, @dnd-kit/sortable 8.0.0 |
| ãƒ†ã‚¹ãƒˆ | Vitest v4.0.13 |

# 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

## 2.1 ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆï¼ˆæ›´æ–°ç‰ˆï¼‰

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ auth/[...nextauth]/route.ts
â”‚   â”‚   â”œâ”€â”€ coach/
â”‚   â”‚   â”œâ”€â”€ credo/
â”‚   â”‚   â”œâ”€â”€ notes/
â”‚   â”‚   â”‚   â”œâ”€â”€ route.ts
â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚       â”œâ”€â”€ route.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ image/route.ts
â”‚   â”‚   â”‚       â””â”€â”€ ocr/route.ts
â”‚   â”‚   â”œâ”€â”€ report/weekly/
â”‚   â”‚   â”œâ”€â”€ settings/profile/route.ts
â”‚   â”‚   â””â”€â”€ tasks/route.ts
â”‚   â”œâ”€â”€ coach/page.tsx
â”‚   â”œâ”€â”€ dashboard/page.tsx
â”‚   â”œâ”€â”€ plan/page.tsx
â”‚   â”œâ”€â”€ credo/page.tsx
â”‚   â”œâ”€â”€ report/page.tsx
â”‚   â”œâ”€â”€ notes/
â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ canvas/page.tsx
â”‚   â”œâ”€â”€ settings/page.tsx
â”‚   â””â”€â”€ auth/signin/page.tsx
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ notes/
â”‚   â”‚   â”œâ”€â”€ CameraCapture.tsx
â”‚   â”‚   â””â”€â”€ OcrProcessor.tsx
â”‚   â”œâ”€â”€ coach/
â”‚   â”œâ”€â”€ credo/
â”‚   â”œâ”€â”€ layout/AppLayout.tsx
â”‚   â”œâ”€â”€ providers/AuthProvider.tsx
â”‚   â””â”€â”€ ui/Modal.tsx
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ notes/
â”‚   â”‚   â”œâ”€â”€ types.ts
â”‚   â”‚   â”œâ”€â”€ service.ts
â”‚   â”‚   â””â”€â”€ schemas.ts
â”‚   â”œâ”€â”€ report/
â”‚   â”œâ”€â”€ coach/
â”‚   â”œâ”€â”€ llm/
â”‚   â”œâ”€â”€ auth.ts
â”‚   â”œâ”€â”€ prisma.ts
â”‚   â””â”€â”€ rateLimit.ts
â””â”€â”€ config/navigation.ts
```

# 3. ç”»é¢è¨­è¨ˆ

## 3.1 ç”»é¢ä¸€è¦§ï¼ˆæ›´æ–°ç‰ˆï¼‰

| No | ç”»é¢å | ãƒ‘ã‚¹ãƒ»èª¬æ˜ |
| --- | --- | --- |
| 1 | ã‚µã‚¤ãƒ³ã‚¤ãƒ³ | /auth/signin - ãƒ¡ãƒ¼ãƒ«/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ |
| 2 | ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | /dashboard - ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯ãƒ»å­¦ç¿’æ™‚é–“ãƒ»ä½“èª¿ |
| 3 | AIã‚³ãƒ¼ãƒ | /coach - ãƒãƒ£ãƒƒãƒˆãƒ»å­¦ç¿’ãƒ—ãƒ©ãƒ³ç”Ÿæˆ |
| 4 | å­¦ç¿’ãƒ—ãƒ©ãƒ³ | /plan - ã‚¿ã‚¹ã‚¯ç®¡ç†ãƒ»æ™‚é–“è¿½è·¡ |
| 5 | ã‚¯ãƒ¬ãƒ‰ | /credo - 11ç®‡æ¡ãƒ»æ—¥æ¬¡å®Ÿè·µãƒã‚§ãƒƒã‚¯ |
| 6 | é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ | /report - AIç”Ÿæˆãƒ»Markdownã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ |
| 7 | ãƒãƒ¼ãƒˆä¸€è¦§ | /notes - ãƒãƒ¼ãƒˆCRUDãƒ»ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ |
| 8 | ã‚­ãƒ£ãƒ³ãƒã‚¹ | /notes/canvas - Excalidrawãƒ»ã‚«ãƒ¡ãƒ©ãƒ»OCR |
| 9 | è¨­å®š | /settings - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ»ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­è¨­å®š |

## 3.2 ç”»é¢é·ç§»å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ã‚µã‚¤ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå¸¸æ™‚è¡¨ç¤ºï¼‰             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰                                          â”‚
â”‚ ğŸ¤– AIã‚³ãƒ¼ãƒ                                                â”‚
â”‚ ğŸ“‹ å­¦ç¿’ãƒ—ãƒ©ãƒ³                                              â”‚
â”‚ ğŸ¯ ã‚¯ãƒ¬ãƒ‰                                                  â”‚
â”‚ ğŸ“ˆ é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ                                            â”‚
â”‚ ğŸ“ ãƒãƒ¼ãƒˆ â†â†’ /notes/canvas (ã‚­ãƒ£ãƒ³ãƒã‚¹ç·¨é›†)              â”‚
â”‚ âš™ï¸ è¨­å®š                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

# 4. ãƒãƒ¼ãƒˆæ©Ÿèƒ½è¨­è¨ˆã€æ–°è¦ã€‘

## 4.1 æ©Ÿèƒ½æ¦‚è¦

å­¦ç¿’ã®æ€è€ƒã‚’å¤–éƒ¨åŒ–ãƒ»å¯è¦–åŒ–ã™ã‚‹çµ±åˆãƒ„ãƒ¼ãƒ«ã€‚ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ¼ãƒˆã€5W2H/5Whyãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€Excalidrawã‚­ãƒ£ãƒ³ãƒã‚¹ã€ç”»åƒå–ã‚Šè¾¼ã¿ã€OCRã‚’æä¾›ã€‚

| æ©Ÿèƒ½ | èª¬æ˜ | æŠ€è¡“ |
| --- | --- | --- |
| ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ¼ãƒˆ | è‡ªç”±è¨˜è¿° | Textarea + API |
| 5W2H | æ§‹é€ åŒ–æ€è€ƒãƒ•ãƒ¬ãƒ¼ãƒ  | JSON templateData |
| 5Why | èª²é¡Œåˆ†æãƒ•ãƒ¬ãƒ¼ãƒ  | JSON templateData |
| ã‚­ãƒ£ãƒ³ãƒã‚¹æç”» | å›³å½¢ãƒ»æ–‡å­—ãƒ»æ‰‹æ›¸ã | @excalidraw/excalidraw |
| ç”»åƒæŒ¿å…¥ | ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ‰ãƒ­ãƒƒãƒ— | FileReader API |
| ã‚«ãƒ¡ãƒ©æ’®å½± | ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ | MediaDevices API |
| OCR | ç”»åƒâ†’ãƒ†ã‚­ã‚¹ãƒˆ | tesseract.js (jpn+eng) |
| è‡ªç”±ç§»å‹• | å…¨è¦ç´ æ“ä½œ | Excalidraw |

## 4.2 ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

```
model Note {
  id           String   @id @default(cuid())
  userId       String
  title        String?
  content      String?    @db.Text
  drawingData  Json?
  imageFiles   Json?
  ocrTexts     Json?
  templateType String?
  templateData Json?
  tags         Json?
  isShareable  Boolean    @default(false)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  user User @relation(fields: [userId], references: [id])

  @@index([userId, createdAt(sort: Desc)])
  @@index([userId, templateType])
}
```

## 4.3 APIè¨­è¨ˆ

| æ–¹æ³• | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èª¬æ˜ | åˆ¶é™/åˆ† |
| --- | --- | --- | --- |
| GET | /api/notes | ä¸€è¦§ | 60 |
| POST | /api/notes | ä½œæˆ | 30 |
| GET | /api/notes/[id] | è©³ç´° | 120 |
| PATCH | /api/notes/[id] | æ›´æ–° | 60 |
| DELETE | /api/notes/[id] | å‰Šé™¤ | 30 |
| POST | /api/notes/[id]/image | ç”»åƒè¿½åŠ  | 20 |
| POST | /api/notes/[id]/ocr | OCRè¿½åŠ  | 10 |

## 4.4 ã‚­ãƒ£ãƒ³ãƒã‚¹æ©Ÿèƒ½

Excalidrawã«ã‚ˆã‚Šå›³å½¢ãƒ»ãƒ†ã‚­ã‚¹ãƒˆãƒ»æ‰‹æ›¸ããƒ»ç”»åƒæŒ¿å…¥ãƒ»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç§»å‹•ãªã©ã®æç”»ã‚’æä¾›ã€‚

## 4.5 ã‚«ãƒ¡ãƒ©æ’®å½±

MediaDevices + capture å±æ€§ã§ã‚«ãƒ¡ãƒ©èµ·å‹•ã€‚å¤§ããªãƒœã‚¿ãƒ³ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ»HTTPSãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯¾å¿œã€‚

## 4.6 OCR

Tesseract.js (jpn+eng) ã§Progressãƒãƒ¼ä»˜ãã€‚æŠ½å‡ºãƒ†ã‚­ã‚¹ãƒˆã¯ç·¨é›†å¾Œ Excalidraw ã«è¦ç´ ã¨ã—ã¦é…ç½®å¯èƒ½ã€‚

## 4.7 ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

### 5W2H

```
interface Template5W2H {
  what: string;
  why: string;
  who: string;
  when: string;
  where: string;
  how: string;
  howMuch: string;
}
```

### 5Why

```
interface Template5Why {
  problem: string;
  why1: string;
  why2: string;
  why3: string;
  why4: string;
  why5: string;
  conclusion: string;
}
```

## 4.8 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä¸€è¦§

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | å½¹å‰² |
| --- | --- |
| src/app/notes/page.tsx | ãƒãƒ¼ãƒˆä¸€è¦§ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»æ¤œç´¢ |
| src/app/notes/canvas/page.tsx | Excalidraw + ã‚«ãƒ¡ãƒ© + OCR |
| CameraCapture.tsx | ã‚«ãƒ¡ãƒ©ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆHTTPSãƒ»ã‚¹ãƒãƒ›å¯¾å¿œï¼‰ |
| OcrProcessor.tsx | Tesseract.js OCRãƒ¢ãƒ¼ãƒ€ãƒ« |

# 5. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

## 5.1 ERå›³

```
User â”€â”€â”¬â”€â”€ UserProfile
       â”œâ”€â”€ ChatMessage
       â”œâ”€â”€ CredoPracticeLog
       â”œâ”€â”€ StudyTask
       â”œâ”€â”€ WeeklyReport
       â””â”€â”€ Note
```

## 5.2 ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§

èª¬æ˜ã‚’è¨˜è¼‰ï¼ˆçœç•¥ï¼‰

# 6. APIè¨­è¨ˆ

(å‰è¿°ã«è¿½åŠ )

# 7. AIã‚³ãƒ¼ãƒè¨­è¨ˆ

ï¼ˆæ—¢å­˜ï¼‰

# 8. é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆè¨­è¨ˆ

ï¼ˆæ—¢å­˜ï¼‰

# 9. ãƒ†ã‚¹ãƒˆè¨­è¨ˆ

## 9.1 ç¾çŠ¶

ï¼ˆæ—¢å­˜ï¼‰

## 9.2 æ¨å¥¨

`tests/notes-api.test.ts` è¿½åŠ 

# 10. ç’°å¢ƒå¤‰æ•°ãƒ»é–‹ç™ºã‚³ãƒãƒ³ãƒ‰

ï¼ˆæ—¢å­˜ï¼‰

# 11. å¤‰æ›´å±¥æ­´

| ç‰ˆ | æ—¥ä»˜ | å†…å®¹ |
| --- | --- | --- |
| v3.0 | 2025-11-28 | ãƒãƒ¼ãƒˆæ©Ÿèƒ½è¿½åŠ  |
